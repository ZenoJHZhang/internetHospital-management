(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-308c"],{"9GVP":function(t,e,a){"use strict";a.r(e);var s=a("gDS+"),r=a.n(s),n=a("zH15"),o=a.n(n),i=a("dNE1"),l=a.n(i),u={props:{reservationData:{type:Array,default:function(){return[]},required:!0,code:0},status:{type:Number,default:0}},data:function(){return{buttonName:"",oneButtonFlag:!1,code:0,message:"",clinicState:0,colors:["#99A9BF","#F7BA2A","#FF9900"],value:"3.7",dialogVisible:!1,uuId:"",form:{},rules:{reason:[{required:!0,message:"请输入过号原因",trigger:"blur"}]},passIndex:0}},created:function(){4===this.status&&this.connect()},mounted:function(){this.$nextTick(function(){4===this.status?(this.buttonName="叫号",this.oneButtonFlag=!0):11===this.status?(this.buttonName="视频问诊",this.oneButtonFlag=!0):12===this.status?(this.buttonName="诊断和开药",this.oneButtonFlag=!0):13!==this.status&&14!==this.status&&17!==this.status&&18!==this.status||(this.buttonName="查看",this.oneButtonFlag=!1)})},methods:{handleClick:function(t,e){if(4===this.status){var a=(new Date).getHours(),s=e.clinicTime,n=s.split("-")[0],o=s.split("-")[1],i=n.split(":")[0],l=o.split(":")[0];i<=a&&a<=l?this.callPatient(t,e):(this.$store.state.errorTokenVisible=!0,this.$store.state.errorTokenMessage="未到叫号时段")}else if(11===this.status){var u=r()(e);localStorage.setItem("userReservation",u),localStorage.setItem("userReservationUuId",e.uuId),this.$router.push({name:"DoctorClinic"})}else if(12===this.status){var c=r()(e);localStorage.setItem("userReservation",c),localStorage.setItem("userReservationUuId",e.uuId),this.$router.push({name:"ClinicResult"})}},callPatient:function(t,e){var a=r()(e),s={userReservationUuId:e.uuId,token:localStorage.getItem("token")};this.stompClient.send("/doc/callUseReservation",{},r()(s)),localStorage.setItem("userReservation",a),localStorage.setItem("userReservationUuId",e.uuId)},getDetail:function(t,e){this.$router.push({name:"ReservationDetail",query:{userReservationUuId:e.uuId}})},connect:function(){var t=this,e=new o.a("https://management.woniuyiliao.cn/api/myWebSocket"),a={Authorization:localStorage.getItem("token")};this.stompClient=l.a.over(e),this.stompClient.connect(a,function(e){t.stompClient.subscribe("/topic/userReservation",function(e){var a=JSON.parse(e.body);t.code=a.code,t.message=a.message,0===t.code?t.$router.push({name:"DoctorClinic"}):1===t.code?(t.$store.state.errorTokenVisible=!0,t.$store.state.errorTokenMessage=t.message):2===t.code&&(t.dialogVisible=!1,t.$store.state.errorTokenVisible=!0,t.$store.state.errorTokenMessage="患者已过号",t.reservationData.splice(t.passIndex,1))},{})},function(t){console.log("失败"),console.log(t)})},forwardCall:function(t,e){this.uuId=e.uuId,this.dialogVisible=!0,this.passIndex=t},confirm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var a={userReservationUuId:e.uuId,token:localStorage.getItem("token"),passReason:e.form.reason};e.stompClient.send("/doc/passUserReservation",{},r()(a))})}}},c=a("KHd+"),d=Object(c.a)(u,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.reservationData,stripe:""}},[a("el-table-column",{attrs:{prop:"patientName",label:"患者姓名",width:"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"patientSex",label:"性别",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"patient.age",label:"年龄",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"regNo",label:"就诊序号",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"departmentName",label:"预约科室"}}),t._v(" "),a("el-table-column",{attrs:{prop:"clinicDate",label:"预约日期"}}),t._v(" "),a("el-table-column",{attrs:{prop:"clinicTime",label:"预约时段"}}),t._v(" "),a("el-table-column",{attrs:{prop:"statusDescription",label:"状态"}}),t._v(" "),16===t.status?a("el-table-column",{attrs:{prop:"examineFailReason",label:"审核不通过原因"}}):t._e(),t._v(" "),18===t.status?a("el-table-column",{attrs:{label:"评价星级"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-rate",{attrs:{"score-template":e.row.evaluateStar,disabled:"","show-score":"","text-color":"#ff9900"},model:{value:e.row.evaluateStar,callback:function(a){t.$set(e.row,"evaluateStar",a)},expression:"scope.row.evaluateStar"}})]}}])}):t._e(),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.oneButtonFlag?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.handleClick(e.$index,e.row)}}},[t._v(t._s(t.buttonName))]):t._e(),t._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){t.getDetail(e.$index,e.row)}}},[t._v("查看")]),t._v(" "),4===t.status?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.forwardCall(e.$index,e.row)}}},[t._v("过号")]):t._e()]}}])})],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,title:"提示",width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"form",attrs:{inline:!0,model:t.form,rules:t.rules}},[a("el-form-item",{attrs:{label:"请填写过号原因",prop:"reason"}},[a("el-input",{attrs:{autosize:{minRows:2},placeholder:"过号原因",type:"textarea"},model:{value:t.form.reason,callback:function(e){t.$set(t.form,"reason",e)},expression:"form.reason"}})],1),t._v(" "),a("br"),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.confirm("form")}}},[t._v("确 定")])],1)],1)],1)],1)},[],!1,null,null,null);d.options.__file="reservationTable.vue";var m=d.exports,v=a("Ut8h"),p=a("JLmY"),b={components:{reservationTable:m},data:function(){return{date:[""],activeName:"待就诊(今日)",startScheduleTime:"",endScheduleTime:"",status:1,pageNumber:1,pageSize:10,total:1,patientName:"",reservationData:[]}},computed:{startTime:function(){return this.date[0]},endTime:function(){return this.date[1]}},mounted:function(){this.$nextTick(function(){this.todayUserReservation(4,!0)})},methods:{todayUserReservation:function(t,e){var a=this,s=void 0,r=void 0,n=void 0;n=e?p.a.getDay(0,"-"):"",null!==this.date&&2===this.date.length?(s=this.startTime,r=this.endTime):(s=n,r=n),this.status=t,Object(v.f)(this.status,s,r,this.patientName,this.pageNumber,this.pageSize).then(function(t){if(200===t.data.returnCode){var e=t.data.returnData;a.total=e.total,a.reservationData=e.list}})},handleClick:function(t,e){"待就诊(今日)"===t.name?this.todayUserReservation(4,!0):"待就诊(日期筛选)"===t.name?this.todayUserReservation(4,!1):"就诊中"===t.name?this.todayUserReservation(11,!1):"待诊断"===t.name?this.todayUserReservation(12,!1):"待审核"===t.name?this.todayUserReservation(13,!1):"审核通过"===t.name?this.todayUserReservation(14,!1):"审核不通过"===t.name?this.todayUserReservation(16,!1):"待评价"===t.name?this.todayUserReservation(17,!1):"已评价"===t.name&&this.todayUserReservation(18,!1)}}},h=Object(c.a)(b,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-container",[a("el-header",{staticStyle:{"margin-top":"50px"}},[a("el-row",{attrs:{gutter:30}},[a("el-col",{attrs:{xs:12,sm:12,md:12,lg:10,xl:6}},[a("div",{staticClass:"block"},[a("span",{staticStyle:{"margin-left":"20px","margin-right":"10px"}},[t._v("日期")]),t._v(" "),a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)]),t._v(" "),a("el-col",{attrs:{xs:12,sm:12,md:12,lg:10,xl:6}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入患者姓名","prefix-icon":"el-icon-search"},model:{value:t.patientName,callback:function(e){t.patientName=e},expression:"patientName"}})],1)],1)],1),t._v(" "),a("el-main",{staticStyle:{padding:"50px","padding-top":"20px"}},[a("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"待就诊(今日)",name:"待就诊(今日)"}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:4}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"待就诊(日期筛选)",name:"待就诊(日期筛选)",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"就诊中",name:"就诊中",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:11}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"待诊断",name:"待诊断",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:12}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"待审核",name:"待审核",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:13}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"审核通过",name:"审核通过",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:14}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"审核不通过",name:"审核不通过",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:16}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"待评价",name:"待评价",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:17}})],1),t._v(" "),a("el-tab-pane",{attrs:{label:"已评价",name:"已评价",lazy:""}},[a("reservation-table",{attrs:{"reservation-data":t.reservationData,status:18}})],1)],1)],1)],1)],1)},[],!1,null,null,null);h.options.__file="index.vue";e.default=h.exports},JLmY:function(t,e,a){"use strict";e.a={getDay:function(t,e){var a=new Date,s=a.getTime(),r=864e5*t;a.setTime(parseInt(s+r));var n=a.getFullYear(),o=(a.getMonth()+1).toString();o.length<=1&&(o="0"+o);var i=a.getDate().toString();return i.length<=1&&(i="0"+i),n+e+o+e+i}}},Ut8h:function(t,e,a){"use strict";a.d(e,"f",function(){return r}),a.d(e,"b",function(){return n}),a.d(e,"c",function(){return o}),a.d(e,"d",function(){return i}),a.d(e,"e",function(){return l}),a.d(e,"a",function(){return u});var s=a("t3Un");function r(t,e,a,r,n,o){return Object(s.a)({url:"/docUserReservation/getUserReservationOfDoctor",method:"post",params:{status:t,startScheduleTime:e,endScheduleTime:a,patientName:r,pageNumber:n,pageSize:o}})}function n(t,e){return Object(s.a)({url:"/docUserReservation/beginOrFinishClinic",method:"post",params:{userReservationUuid:t,flag:e}})}function o(t){return Object(s.a)({url:"/docUserReservation/confirmDoctorReservation",method:"post",params:{userReservationUuid:t}})}function i(t){return Object(s.a)({url:"/userReservation/getAllDetailByUuId",method:"post",params:{userReservationUuId:t}})}function l(t,e,a){return Object(s.a)({url:"/managementUserReservation/getUserReservationByAuditStatus",method:"post",params:{auditStatus:t,pageNo:e,pageSize:a}})}function u(t,e,a){return Object(s.a)({url:"/managementUserReservation/auditUserReservation",method:"post",params:{userReservationUuId:t,auditStatus:e,examineFailReason:a}})}}}]);